<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Settings - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
        }
        .header {
            background: white;
            padding: 20px 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            color: #333;
            font-size: 24px;
        }
        .header-actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .logout-btn {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        .logout-btn:hover {
            background: #c0392b;
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        .image-upload-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-slot {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        .image-slot:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            display: none;
        }
        .image-preview.show {
            display: block;
        }
        .upload-btn {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }
        .upload-btn:hover {
            background: #2980b9;
        }
        .save-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            margin-top: 20px;
        }
        .save-btn:hover {
            transform: translateY(-2px);
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        .success-message.show {
            display: block;
        }
        .file-input {
            display: none;
        }
        .image-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Site Settings</h1>
        <div class="header-actions">
            <a href="/admin/dashboard" class="btn">Back to Dashboard</a>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container">
        <div id="successMessage" class="success-message">Settings saved successfully!</div>

        <form id="settingsForm" onsubmit="saveSettings(event)">
            <div class="section">
                <h2>Basic Information</h2>
                <div class="form-group">
                    <label for="pcName">PC Name (Start Menu)</label>
                    <input type="text" id="pcName" placeholder="e.g., Sujay K's PC" required>
                </div>
                <div class="form-group">
                    <label for="ownerName">Your Name</label>
                    <input type="text" id="ownerName" placeholder="e.g., Sujay K" required>
                </div>
                <div class="form-group">
                    <label for="ownerEmail">Your Email</label>
                    <input type="email" id="ownerEmail" placeholder="e.g., your@email.com" required>
                </div>
            </div>

            <div class="section">
                <h2>Website Titles</h2>
                <div class="form-group">
                    <label for="welcomeTitle">Welcome Page Title</label>
                    <input type="text" id="welcomeTitle" placeholder="e.g., Welcome To Sujay K's Personal Website" required>
                </div>
                <div class="form-group">
                    <label for="browserTabTitle">Browser Tab Title</label>
                    <input type="text" id="browserTabTitle" placeholder="e.g., Sujay K's Personal Website - Home Page" required>
                </div>
            </div>

            <div class="section">
                <h2>Social Links</h2>
                <div class="form-group">
                    <label for="githubUrl">GitHub URL</label>
                    <input type="url" id="githubUrl" placeholder="https://github.com/yourusername">
                </div>
                <div class="form-group">
                    <label for="linkedinUrl">LinkedIn URL</label>
                    <input type="url" id="linkedinUrl" placeholder="https://linkedin.com/in/yourusername">
                </div>
            </div>

            <div class="section">
                <h2>About Me Content</h2>
                <div class="form-group">
                    <label for="aboutIntro">Introduction</label>
                    <textarea id="aboutIntro" placeholder="Tell visitors about yourself..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="aboutWhySite">Why This Site?</label>
                    <textarea id="aboutWhySite" placeholder="Explain why you created this site..."></textarea>
                </div>
                <div class="form-group">
                    <label for="aboutInterests">Interests Section 1</label>
                    <textarea id="aboutInterests" placeholder="Your interests and hobbies..."></textarea>
                </div>
                <div class="form-group">
                    <label for="aboutInterests2">Interests Section 2</label>
                    <textarea id="aboutInterests2" placeholder="More about your interests..."></textarea>
                </div>
                <div class="form-group">
                    <label for="aboutInterests3">Interests Section 3</label>
                    <textarea id="aboutInterests3" placeholder="Additional interests..."></textarea>
                </div>
            </div>

            <div class="section">
                <h2>Profile Images</h2>
                <p style="color: #666; margin-bottom: 20px;">Upload up to 4 profile images to display in your About Me section</p>
                <div class="image-upload-container">
                    <div class="image-slot">
                        <div class="image-label">Profile Image 1</div>
                        <img id="preview1" class="image-preview" alt="Preview 1">
                        <input type="file" id="file1" class="file-input" accept="image/*" onchange="handleImageUpload(1)">
                        <button type="button" class="upload-btn" onclick="document.getElementById('file1').click()">Choose Image</button>
                    </div>
                    <div class="image-slot">
                        <div class="image-label">Profile Image 2</div>
                        <img id="preview2" class="image-preview" alt="Preview 2">
                        <input type="file" id="file2" class="file-input" accept="image/*" onchange="handleImageUpload(2)">
                        <button type="button" class="upload-btn" onclick="document.getElementById('file2').click()">Choose Image</button>
                    </div>
                    <div class="image-slot">
                        <div class="image-label">Profile Image 3</div>
                        <img id="preview3" class="image-preview" alt="Preview 3">
                        <input type="file" id="file3" class="file-input" accept="image/*" onchange="handleImageUpload(3)">
                        <button type="button" class="upload-btn" onclick="document.getElementById('file3').click()">Choose Image</button>
                    </div>
                    <div class="image-slot">
                        <div class="image-label">Profile Image 4</div>
                        <img id="preview4" class="image-preview" alt="Preview 4">
                        <input type="file" id="file4" class="file-input" accept="image/*" onchange="handleImageUpload(4)">
                        <button type="button" class="upload-btn" onclick="document.getElementById('file4').click()">Choose Image</button>
                    </div>
                </div>
            </div>

            <button type="submit" class="save-btn">Save All Settings</button>
        </form>
    </div>

    <script>
        async function loadSettings() {
            try {
                const response = await fetch('/admin/settings');
                const settings = await response.json();
                
                document.getElementById('pcName').value = settings.pc_name || '';
                document.getElementById('ownerName').value = settings.owner_name || '';
                document.getElementById('ownerEmail').value = settings.owner_email || '';
                document.getElementById('welcomeTitle').value = settings.welcome_title || '';
                document.getElementById('browserTabTitle').value = settings.browser_tab_title || '';
                document.getElementById('githubUrl').value = settings.github_url || '';
                document.getElementById('linkedinUrl').value = settings.linkedin_url || '';
                document.getElementById('aboutIntro').value = settings.about_intro || '';
                document.getElementById('aboutWhySite').value = settings.about_why_site || '';
                document.getElementById('aboutInterests').value = settings.about_interests || '';
                document.getElementById('aboutInterests2').value = settings.about_interests2 || '';
                document.getElementById('aboutInterests3').value = settings.about_interests3 || '';
                
                if (settings.profile_image_1) {
                    document.getElementById('preview1').src = settings.profile_image_1;
                    document.getElementById('preview1').classList.add('show');
                }
                if (settings.profile_image_2) {
                    document.getElementById('preview2').src = settings.profile_image_2;
                    document.getElementById('preview2').classList.add('show');
                }
                if (settings.profile_image_3) {
                    document.getElementById('preview3').src = settings.profile_image_3;
                    document.getElementById('preview3').classList.add('show');
                }
                if (settings.profile_image_4) {
                    document.getElementById('preview4').src = settings.profile_image_4;
                    document.getElementById('preview4').classList.add('show');
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function handleImageUpload(slot) {
            const fileInput = document.getElementById(`file${slot}`);
            const preview = document.getElementById(`preview${slot}`);
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.classList.add('show');
            };
            reader.readAsDataURL(file);
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('slot', slot);
            
            try {
                const response = await fetch('/admin/update-profile-image', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (response.ok) {
                    console.log(`Image ${slot} uploaded successfully`);
                } else {
                    alert('Failed to upload image: ' + data.error);
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Failed to upload image');
            }
        }

        async function saveSettings(event) {
            event.preventDefault();
            
            const settings = {
                pc_name: document.getElementById('pcName').value,
                owner_name: document.getElementById('ownerName').value,
                owner_email: document.getElementById('ownerEmail').value,
                welcome_title: document.getElementById('welcomeTitle').value,
                browser_tab_title: document.getElementById('browserTabTitle').value,
                github_url: document.getElementById('githubUrl').value,
                linkedin_url: document.getElementById('linkedinUrl').value,
                about_intro: document.getElementById('aboutIntro').value,
                about_why_site: document.getElementById('aboutWhySite').value,
                about_interests: document.getElementById('aboutInterests').value,
                about_interests2: document.getElementById('aboutInterests2').value,
                about_interests3: document.getElementById('aboutInterests3').value
            };
            
            try {
                const response = await fetch('/admin/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    const successMessage = document.getElementById('successMessage');
                    successMessage.classList.add('show');
                    setTimeout(() => {
                        successMessage.classList.remove('show');
                    }, 3000);
                    window.scrollTo(0, 0);
                } else {
                    alert('Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Failed to save settings');
            }
        }

        async function logout() {
            await fetch('/admin/logout', { method: 'POST' });
            window.location.href = '/admin/login';
        }

        loadSettings();
    </script>
</body>
</html>
